{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useContext, useEffect } from \"react\";\nimport { Cookies } from \"react-cookie\";\nimport { useNavigate } from \"react-router-dom\";\nimport AuthContext from \"../Contexts/AuthContext\";\nimport apiClient from \"../Services/api\";\nimport API_URL from '../config';\nexport const useAuth = () => {\n  _s();\n  let navigate = useNavigate();\n  const [userData, setUserData] = React.useState({\n    signedIn: false,\n    user: true\n  });\n  const {\n    setAuthData\n  } = useContext(AuthContext);\n  useEffect(() => {\n    setAuthData(userData);\n  }, [userData.signedIn]);\n  function getAuthCookieExpiration() {\n    let date = new Date();\n    date.setTime(date.getTime() + 7 * 24 * 60 * 60 * 1000); // 7 days\n    return date;\n  }\n  function setAsLogged(user) {\n    const cookie = new Cookies();\n    cookie.set('is_auth', true, {\n      path: '/',\n      expires: getAuthCookieExpiration(),\n      sameSite: 'lax',\n      httpOnly: false\n    });\n    setUserData({\n      signedIn: true,\n      user\n    });\n    navigate('/');\n  }\n  function setLogout() {\n    const cookie = new Cookies();\n    cookie.remove('is_auth', {\n      path: '/',\n      expires: getAuthCookieExpiration(),\n      sameSite: 'lax',\n      httpOnly: false\n    });\n    setUserData({\n      signedIn: false,\n      user: null\n    });\n    navigate('/');\n  }\n  function loginUserOnStartup() {\n    const cookie = new Cookies();\n    if (cookie.get('is_auth')) {\n      apiClient.post(API_URL + '/api/user').then(response => {\n        setUserData({\n          signedIn: true,\n          user: response.data.user\n        });\n        navigate('/');\n      }).catch(error => {\n        setUserData({\n          signedIn: false,\n          user: null\n        });\n        setLogout();\n      });\n    } else {\n      setUserData({\n        signedIn: false,\n        user: null\n      });\n      navigate('/');\n    }\n  }\n  function redirectToLogin() {\n    navigate('/signIn');\n  }\n  return {\n    userData,\n    setAsLogged,\n    setLogout,\n    loginUserOnStartup,\n    redirectToLogin\n  };\n};\n_s(useAuth, \"T/S28V972Qh+v8PQOAKw81GnwOE=\", false, function () {\n  return [useNavigate];\n});","map":{"version":3,"names":["React","useContext","useEffect","Cookies","useNavigate","AuthContext","apiClient","API_URL","useAuth","_s","navigate","userData","setUserData","useState","signedIn","user","setAuthData","getAuthCookieExpiration","date","Date","setTime","getTime","setAsLogged","cookie","set","path","expires","sameSite","httpOnly","setLogout","remove","loginUserOnStartup","get","post","then","response","data","catch","error","redirectToLogin"],"sources":["/home/sfn/Take Home Project/react-news-feed/src/Hooks/useAuth.js"],"sourcesContent":["import React, {useContext, useEffect} from \"react\";\nimport {Cookies} from \"react-cookie\";\nimport {useNavigate} from \"react-router-dom\";\n\nimport AuthContext from \"../Contexts/AuthContext\";\nimport apiClient from \"../Services/api\";\nimport API_URL from '../config';\nexport const useAuth = () => {\n    let navigate = useNavigate();\n\n    const [userData, setUserData] = React.useState({signedIn: false, user: true});\n\n    const {setAuthData} = useContext(AuthContext);\n\n    useEffect(() => {\n        setAuthData(userData);\n    }, [userData.signedIn]);\n\n    function getAuthCookieExpiration()\n    {\n        let date = new Date();\n        date.setTime(date.getTime() + (7 * 24 * 60 * 60 * 1000));  // 7 days\n        return date;\n    }\n\n    function setAsLogged(user) {\n\n        const cookie = new Cookies();\n\n        cookie.set('is_auth', true, {path: '/', expires: getAuthCookieExpiration(), sameSite: 'lax', httpOnly: false});\n\n        setUserData({signedIn: true, user});\n\n        navigate('/');\n    }\n\n    function setLogout() {\n        const cookie = new Cookies();\n\n        cookie.remove('is_auth', {path: '/', expires: getAuthCookieExpiration(), sameSite: 'lax', httpOnly: false});\n\n        setUserData({signedIn: false, user: null});\n\n        navigate('/');\n    }\n\n    function loginUserOnStartup()\n    {\n        const cookie = new Cookies();\n        if(cookie.get('is_auth')) {\n\n            apiClient.post(API_URL+'/api/user').then(response => {\n                setUserData({signedIn: true, user: response.data.user});\n                navigate('/');\n            }).catch(error => {\n                setUserData({signedIn: false, user: null});\n                setLogout();\n            });\n\n        } else {\n            setUserData({signedIn: false, user: null});\n            navigate('/');\n        }\n    }\n\n    function redirectToLogin() {\n        navigate('/signIn');\n    }\n\n    return {\n        userData,\n        setAsLogged,\n        setLogout,\n        loginUserOnStartup,\n        redirectToLogin\n    }\n\n};"],"mappings":";AAAA,OAAOA,KAAK,IAAGC,UAAU,EAAEC,SAAS,QAAO,OAAO;AAClD,SAAQC,OAAO,QAAO,cAAc;AACpC,SAAQC,WAAW,QAAO,kBAAkB;AAE5C,OAAOC,WAAW,MAAM,yBAAyB;AACjD,OAAOC,SAAS,MAAM,iBAAiB;AACvC,OAAOC,OAAO,MAAM,WAAW;AAC/B,OAAO,MAAMC,OAAO,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACzB,IAAIC,QAAQ,GAAGN,WAAW,CAAC,CAAC;EAE5B,MAAM,CAACO,QAAQ,EAAEC,WAAW,CAAC,GAAGZ,KAAK,CAACa,QAAQ,CAAC;IAACC,QAAQ,EAAE,KAAK;IAAEC,IAAI,EAAE;EAAI,CAAC,CAAC;EAE7E,MAAM;IAACC;EAAW,CAAC,GAAGf,UAAU,CAACI,WAAW,CAAC;EAE7CH,SAAS,CAAC,MAAM;IACZc,WAAW,CAACL,QAAQ,CAAC;EACzB,CAAC,EAAE,CAACA,QAAQ,CAACG,QAAQ,CAAC,CAAC;EAEvB,SAASG,uBAAuBA,CAAA,EAChC;IACI,IAAIC,IAAI,GAAG,IAAIC,IAAI,CAAC,CAAC;IACrBD,IAAI,CAACE,OAAO,CAACF,IAAI,CAACG,OAAO,CAAC,CAAC,GAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAK,CAAC,CAAC,CAAE;IAC3D,OAAOH,IAAI;EACf;EAEA,SAASI,WAAWA,CAACP,IAAI,EAAE;IAEvB,MAAMQ,MAAM,GAAG,IAAIpB,OAAO,CAAC,CAAC;IAE5BoB,MAAM,CAACC,GAAG,CAAC,SAAS,EAAE,IAAI,EAAE;MAACC,IAAI,EAAE,GAAG;MAAEC,OAAO,EAAET,uBAAuB,CAAC,CAAC;MAAEU,QAAQ,EAAE,KAAK;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC;IAE9GhB,WAAW,CAAC;MAACE,QAAQ,EAAE,IAAI;MAAEC;IAAI,CAAC,CAAC;IAEnCL,QAAQ,CAAC,GAAG,CAAC;EACjB;EAEA,SAASmB,SAASA,CAAA,EAAG;IACjB,MAAMN,MAAM,GAAG,IAAIpB,OAAO,CAAC,CAAC;IAE5BoB,MAAM,CAACO,MAAM,CAAC,SAAS,EAAE;MAACL,IAAI,EAAE,GAAG;MAAEC,OAAO,EAAET,uBAAuB,CAAC,CAAC;MAAEU,QAAQ,EAAE,KAAK;MAAEC,QAAQ,EAAE;IAAK,CAAC,CAAC;IAE3GhB,WAAW,CAAC;MAACE,QAAQ,EAAE,KAAK;MAAEC,IAAI,EAAE;IAAI,CAAC,CAAC;IAE1CL,QAAQ,CAAC,GAAG,CAAC;EACjB;EAEA,SAASqB,kBAAkBA,CAAA,EAC3B;IACI,MAAMR,MAAM,GAAG,IAAIpB,OAAO,CAAC,CAAC;IAC5B,IAAGoB,MAAM,CAACS,GAAG,CAAC,SAAS,CAAC,EAAE;MAEtB1B,SAAS,CAAC2B,IAAI,CAAC1B,OAAO,GAAC,WAAW,CAAC,CAAC2B,IAAI,CAACC,QAAQ,IAAI;QACjDvB,WAAW,CAAC;UAACE,QAAQ,EAAE,IAAI;UAAEC,IAAI,EAAEoB,QAAQ,CAACC,IAAI,CAACrB;QAAI,CAAC,CAAC;QACvDL,QAAQ,CAAC,GAAG,CAAC;MACjB,CAAC,CAAC,CAAC2B,KAAK,CAACC,KAAK,IAAI;QACd1B,WAAW,CAAC;UAACE,QAAQ,EAAE,KAAK;UAAEC,IAAI,EAAE;QAAI,CAAC,CAAC;QAC1Cc,SAAS,CAAC,CAAC;MACf,CAAC,CAAC;IAEN,CAAC,MAAM;MACHjB,WAAW,CAAC;QAACE,QAAQ,EAAE,KAAK;QAAEC,IAAI,EAAE;MAAI,CAAC,CAAC;MAC1CL,QAAQ,CAAC,GAAG,CAAC;IACjB;EACJ;EAEA,SAAS6B,eAAeA,CAAA,EAAG;IACvB7B,QAAQ,CAAC,SAAS,CAAC;EACvB;EAEA,OAAO;IACHC,QAAQ;IACRW,WAAW;IACXO,SAAS;IACTE,kBAAkB;IAClBQ;EACJ,CAAC;AAEL,CAAC;AAAC9B,EAAA,CAtEWD,OAAO;EAAA,QACDJ,WAAW;AAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}