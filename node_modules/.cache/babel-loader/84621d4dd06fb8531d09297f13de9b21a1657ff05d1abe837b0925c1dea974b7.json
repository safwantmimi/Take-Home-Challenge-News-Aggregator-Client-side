{"ast":null,"code":"import _slicedToArray from\"/home/sfn/react-news-feed/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect}from\"react\";import{Cookies}from\"react-cookie\";import{useNavigate}from\"react-router-dom\";import AuthContext from\"../Contexts/AuthContext\";export var useAuth=function useAuth(){var navigate=useNavigate();var _React$useState=React.useState({signedIn:true,user:true}),_React$useState2=_slicedToArray(_React$useState,2),userData=_React$useState2[0],setUserData=_React$useState2[1];var _useContext=useContext(AuthContext),setAuthData=_useContext.setAuthData;useEffect(function(){setAuthData(userData);},[userData.signedIn]);function getAuthCookieExpiration(){var date=new Date();date.setTime(date.getTime()+7*24*60*60*1000);// 7 days\nreturn date;}function setAsLogged(user){var cookie=new Cookies();cookie.set('is_auth',true,{path:'/',expires:getAuthCookieExpiration(),sameSite:'lax',httpOnly:false});setUserData({signedIn:true,user:user});navigate('/');}function setLogout(){var cookie=new Cookies();cookie.remove('is_auth',{path:'/',expires:getAuthCookieExpiration(),sameSite:'lax',httpOnly:false});setUserData({signedIn:false,user:null});navigate('/login');}function loginUserOnStartup(){var cookie=new Cookies();if(cookie.get('is_auth')){axios.post('/api/me').then(function(response){setUserData({signedIn:true,user:response.data.user});navigate('/');}).catch(function(error){setUserData({signedIn:false,user:null});setLogout();});}else{setUserData({signedIn:false,user:null});navigate('/login');}}return{userData:userData,setAsLogged:setAsLogged,setLogout:setLogout,loginUserOnStartup:loginUserOnStartup};};","map":{"version":3,"names":["React","useContext","useEffect","Cookies","useNavigate","AuthContext","useAuth","navigate","_React$useState","useState","signedIn","user","_React$useState2","_slicedToArray","userData","setUserData","_useContext","setAuthData","getAuthCookieExpiration","date","Date","setTime","getTime","setAsLogged","cookie","set","path","expires","sameSite","httpOnly","setLogout","remove","loginUserOnStartup","get","axios","post","then","response","data","catch","error"],"sources":["/home/sfn/react-news-feed/src/Hooks/useAuth.js"],"sourcesContent":["import React, {useContext, useEffect} from \"react\";\nimport {Cookies} from \"react-cookie\";\nimport {useNavigate} from \"react-router-dom\";\n\nimport AuthContext from \"../Contexts/AuthContext\";\n\nexport const useAuth = () => {\n    let navigate = useNavigate();\n\n    const [userData, setUserData] = React.useState({signedIn: true, user: true});\n\n    const {setAuthData} = useContext(AuthContext);\n\n    useEffect(() => {\n        setAuthData(userData);\n    }, [userData.signedIn]);\n\n    function getAuthCookieExpiration()\n    {\n        let date = new Date();\n        date.setTime(date.getTime() + (7 * 24 * 60 * 60 * 1000));  // 7 days\n        return date;\n    }\n\n    function setAsLogged(user) {\n\n        const cookie = new Cookies();\n\n        cookie.set('is_auth', true, {path: '/', expires: getAuthCookieExpiration(), sameSite: 'lax', httpOnly: false});\n\n        setUserData({signedIn: true, user});\n\n        navigate('/');\n    }\n\n    function setLogout() {\n        const cookie = new Cookies();\n\n        cookie.remove('is_auth', {path: '/', expires: getAuthCookieExpiration(), sameSite: 'lax', httpOnly: false});\n\n        setUserData({signedIn: false, user: null});\n\n        navigate('/login');\n    }\n\n    function loginUserOnStartup()\n    {\n        const cookie = new Cookies();\n        if(cookie.get('is_auth')) {\n\n            axios.post('/api/me').then(response => {\n                setUserData({signedIn: true, user: response.data.user});\n                navigate('/');\n            }).catch(error => {\n                setUserData({signedIn: false, user: null});\n                setLogout();\n            });\n\n        } else {\n            setUserData({signedIn: false, user: null});\n            navigate('/login');\n        }\n    }\n\n    return {\n        userData,\n        setAsLogged,\n        setLogout,\n        loginUserOnStartup\n    }\n\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}